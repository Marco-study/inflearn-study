# 23/01/03) request ìŠ¤ì½”í”„

ì›¹ í™˜ê²½ì—ì„œë§Œ ë™ì‘í•˜ëŠ” ìŠ¤ì½”í”„

<aside>
ğŸ’¡ ìŠ¤í”„ë§ ë¶€íŠ¸ëŠ” ì›¹ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì—†ìœ¼ë©´ `AnnotationConfigApplicationContext`ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ êµ¬ë™í•œë‹¤. ì›¹ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì¶”ê°€ë˜ë©´ ì›¹ê³¼ ê´€ë ¨ëœ ì¶”ê°€ ì„¤ì •ê³¼ í™˜ê²½ë“¤ì´ í•„ìš”í•˜ë¯€ë¡œ `AnnotationConfigServletWebServerApplicationContext`ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ êµ¬ë™í•œë‹¤.

</aside>

Request ìŠ¤ì½”í”„ëŠ” ë™ì‹œì— ì—¬ëŸ¬ HTTP ìš”ì²­ì´ ì™”ì„ ë•Œ ì •í™•íˆ ì–´ë–¤ ìš”ì²­ì´ ë‚¨ê¸´ ë¡œê·¸ì¸ì§€ êµ¬ë¶„í•˜ê¸° í˜ë“¤ ë•Œ íš¨ìœ¨ì ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. 

```java
[d059123...] request scop bean create
[24fsa23...] request scop bean create
[df1ds31...] request scop bean create
[dvr2341...] request scop bean create
```

```java
@Component
@Scope(vlaue = "request")
public class MyLogger {
	private String uuid;
	private String rueqestURL;

	public void setRequestURL(String requestURL) {
		this.requestURL = requestURL;
	}

	public void log(String message) {
		System.out.println("[" + uuid + "]" + "[" + requestURL + "]" + message);
	}

	@PostConstruct
	public void init() {
		uuid = UUID.randomUUID().toString();
	}
}
```

- ë¡œê·¸ë¥¼ ì¶œë ¥í•˜ê¸° ìœ„í•œ í´ë˜ìŠ¤
- request ìŠ¤ì½”í”„ë¡œ ì§€ì •í–ˆë‹¤.
- HTTP ìš”ì²­ë§ˆë‹¤ ìƒˆë¡­ê²Œ ë¹ˆì´ ìƒì„±ëœë‹¤.

```java
@Controller
@RequiredARgsConstructor
public class LogDemoController {

	private final LogDemoService logDemoService;
	private final MyLogger myLogger;

	@RequestMapping("log-demo")
	@ResponseBody
	public String logDemo(HttpServletRequest request) {
		String reuqestURL = request.getRequestURL().toString();
		myLogger.setRequestURL(requestURL);
		myLogger.log("Controller Test");
	}
}
```

í•˜ì§€ë§Œ ìœ„ ìƒíƒœë¡œ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ë©´ ì˜¤ë¥˜ê°€ ë°œìƒí•œë‹¤. `LogDemoContoroller`ëŠ” ì–´í”Œë¦¬ì¼€ì´ì…˜ì´ ì‹¤í–‰ë˜ê³  ìŠ¤í”„ë§ì´ ë¹ˆìœ¼ë¡œ ë“±ë¡í•˜ê³  ì˜ì¡´ê´€ê³„ë¥¼ ì£¼ì…í•  ë•Œ `MyLogger`ë¥¼ ì£¼ì…í•´ì•¼ í•˜ëŠ”ë°, `MyLogger`ëŠ” request ìŠ¤ì½”í”„ì´ê¸° ë•Œë¬¸ì— ì‚¬ìš©ì ìš”ì²­ì´ ì—†ëŠ” ì§€ê¸ˆ ì£¼ì…í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì´ë‹¤. â†’ `Provider`ë¥¼ ì‚¬ìš©í•œë‹¤.

ë‹¤ìŒê³¼ ê°™ì´ ìˆ˜ì •í•œë‹¤.

```java
@Controller
@RequiredARgsConstructor
public class LogDemoController {

	private final LogDemoService logDemoService;
	private final ObjectProvider<MyLogger> myLoggerProvider;

	@RequestMapping("log-demo")
	@ResponseBody
	public String logDemo(HttpServletRequest request) {
		String reuqestURL = request.getRequestURL().toString();
		MyLogger myLogger = myLoggerProvider.getObject();
		myLogger.setRequestURL(requestURL);
		myLogger.log("Controller Test");
	}
}
```

- `ObjectProvider` ë•ë¶„ì— `ObjectProvider.getObject()`ë¥¼ í˜¸ì¶œí•˜ëŠ” ì‹œì ê¹Œì§€ request scope ë¹ˆì˜ ìƒì„±ì„ ì§€ì—°í•  ìˆ˜ ìˆë‹¤.

## ìŠ¤ì½”í”„ì™€ í”„ë¡ì‹œ

ìœ„ ì½”ë“œë¥¼ ë” ê°„ë‹¨í•˜ê²Œ ì¤„ì¼ ìˆ˜ ìˆë‹¤.

```java
@Component
@Scope(vlaue = "request", proxyMode = ScopedProxyMode.TARGET_CLASS)
public class MyLogger {
	private String uuid;
	private String rueqestURL;

	public void setRequestURL(String requestURL) {
		this.requestURL = requestURL;
	}

	public void log(String message) {
		System.out.println("[" + uuid + "]" + "[" + requestURL + "]" + message);
	}

	@PostConstruct
	public void init() {
		uuid = UUID.randomUUID().toString();
	}
}
```

- `proxyMode=ScopedProxyMode.TARGET_CLASS` ì„¤ì •ì„ ì¶”ê°€í•œë‹¤.
    - ì ìš© ëŒ€ìƒì´ ì¸í„°í˜ì´ìŠ¤ê°€ ì•„ë‹Œ í´ë˜ìŠ¤ë¼ë©´ `TARGET_CLASS`
    - ì ìš© ëŒ€ìƒì´ ì¸í„°í˜ì´ìŠ¤ë¼ë©´ `INTERFACES`ë¥¼ ì„ íƒí•œë‹¤.
- `MyLogger`ì˜ ê°ì í”„ë¡ì‹œ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ë‘ê³  HTTP Requestì™€ ìƒê´€ì—†ì´ ê°€ì§œ í”„ë¡ì‹œ í´ë˜ìŠ¤ë¥¼ ë‹¤ë¥¸ ë¹ˆì— ë¯¸ë¦¬ ì£¼ì…í•´ ë‘˜ ìˆ˜ ìˆë‹¤. (CGLIB)
    - ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” CGLIBì„ ì´ìš©í•˜ì—¬ `MyLogger`ë¥¼ ìƒì†ë°›ì€ ê°€ì§œ í”„ë¡ì‹œ ê°ì²´ë¥¼ ìƒì„±í•œë‹¤.
    - ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— `myLogger`ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ì§„ì§œ ëŒ€ì‹ ì— ê°€ì§œ í”„ë¡ì‹œ ê°ì²´ë¥¼ ë“±ë¡í•œë‹¤.
    - `ac.getBean(MyLogger.class)`ë¥¼ í•´ë„ í”„ë¡ì‹œ ê°ì²´ê°€ ì¡°íšŒëœë‹¤.
    - ì˜ì¡´ê´€ê³„ ì£¼ì…ë„ ê°€ì§œ í”„ë¡ì‹œ ê°ì²´ê°€ ì£¼ì…ëœë‹¤.
    - ê°€ì§œ í”„ë¡ì‹œ ê°ì²´ëŠ” ì‹¤ì œ ìš”ì²­ì´ ì˜¤ë©´ ë‚´ë¶€ì—ì„œ ì§„ì§œ ë¹ˆì„ ìš”ì²­í•˜ëŠ” ìœ„ì„ ë¡œì§ì´ ë“¤ì–´ê°€ ìˆë‹¤.

```java
@Controller
@RequiredARgsConstructor
public class LogDemoController {

	private final LogDemoService logDemoService;
	private final MyLogger myLogger;

	@RequestMapping("log-demo")
	@ResponseBody
	public String logDemo(HttpServletRequest request) {
		String reuqestURL = request.getRequestURL().toString();
		MyLogger myLogger = myLoggerProvider.getObject();
		myLogger.setRequestURL(requestURL);
		myLogger.log("Controller Test");
	}
}
```

**************ì£¼ì˜ì **************

- ë§ˆì¹˜ ì‹±ê¸€í†¤ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒ ê°™ì§€ë§Œ ë‹¤ë¥´ê²Œ ë™ì‘í•˜ê¸° ë•Œë¬¸ì— ì£¼ì˜í•œë‹¤.
- ì‹±ê¸€í†¤ì´ ì•„ë‹Œ ë‹¤ë¥¸ ìŠ¤ì½”í”„ëŠ” ê¼­ í•„ìš”í•œ ê³³ì—ë§Œ ìµœì†Œí™”í•˜ì—¬ ì‚¬ìš©í•œë‹¤. (ìœ ì§€ë³´ìˆ˜ë¥¼ ìœ„í•´)
